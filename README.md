# Key-Face-Frame v2.0

**è§†é¢‘äººç‰©å…³é”®å¸§æå–å·¥å…·** - ä»è§†é¢‘ä¸­è‡ªåŠ¨æ£€æµ‹äººç‰©ï¼Œæ™ºèƒ½æå–é«˜è´¨é‡å…³é”®å¸§

[![Version](https://img.shields.io/badge/version-2.0.0-blue.svg)](https://github.com/MarcelLeon/key-face-frame)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![React](https://img.shields.io/badge/React-18-61dafb.svg)](https://reactjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-3178c6.svg)](https://www.typescriptlang.org/)

## ğŸ‰ v2.0 å®Œæ•´Webåº”ç”¨å·²ä¸Šçº¿ï¼

ä»å‘½ä»¤è¡Œå·¥å…·å‡çº§ä¸º**å®Œæ•´çš„Webåº”ç”¨**ï¼Œæä¾›ç°ä»£åŒ–çš„ç”¨æˆ·ä½“éªŒã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ¯ **æ™ºèƒ½æ£€æµ‹**: YOLOv8äººç‰©æ£€æµ‹ï¼Œç²¾å‡†è¯†åˆ«è§†é¢‘ä¸­çš„äººç‰©
- ğŸ“Š **å¤šç»´è¯„åˆ†**: äººç‰©å¤§å°(40%) + ç½®ä¿¡åº¦(30%) + å±…ä¸­åº¦(20%) + ç¨³å®šæ€§(10%)
- ğŸš€ **å®æ—¶è¿›åº¦**: åŠ¨æ€è½®è¯¢æœºåˆ¶ï¼Œå®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦å’Œå½“å‰é˜¶æ®µ
- ğŸ“¤ **æ‹–æ‹½ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ ï¼Œæœ€å¤§500MB
- âš™ï¸  **çµæ´»é…ç½®**: 3ä¸ªé¢„è®¾æ¨¡æ¿ + è‡ªå®šä¹‰å‚æ•°ï¼ˆé‡‡æ ·ç‡ã€å…³é”®å¸§æ•°ã€ç½®ä¿¡åº¦ï¼‰
- ğŸ–¼ï¸ **å…³é”®å¸§ç”»å»Š**: å“åº”å¼ç½‘æ ¼å¸ƒå±€ï¼Œæ”¯æŒæŒ‰è¯„åˆ†/æ—¶é—´æ’åº
- ğŸ’¾ **æ‰¹é‡ä¸‹è½½**: ZIPæ‰“åŒ…ä¸‹è½½æ‰€æœ‰å…³é”®å¸§
- ğŸ **Apple Silicon**: åŸç”Ÿæ”¯æŒMç³»åˆ—èŠ¯ç‰‡MPSåŠ é€Ÿ

### ğŸ“¸ ç•Œé¢é¢„è§ˆ

**Webç•Œé¢**:
<img width="1333" height="945" alt="ä¸Šä¼ ç•Œé¢" src="https://github.com/user-attachments/assets/a674698b-7f1e-4000-b604-ab9fbd26cf70" />
<img width="1246" height="948" alt="ç»“æœå±•ç¤º" src="https://github.com/user-attachments/assets/2e1b8af3-e566-4747-93fa-72ddf87d24aa" />

**æå–æ•ˆæœ**ï¼ˆä»¥ã€Šå‡¡äººé‡è¿”å¤©å—16é›†ã€‹é¢„å‘Šä¸ºä¾‹ï¼‰:
<img width="715" height="398" alt="å…³é”®å¸§1" src="https://github.com/user-attachments/assets/5d3016d9-0fc8-4ae8-8893-5d89388da13f" />
<img width="712" height="398" alt="å…³é”®å¸§2" src="https://github.com/user-attachments/assets/b407e722-bdf1-42ad-b3f6-7c6cf3ce03f0" />
<img width="718" height="398" alt="å…³é”®å¸§3" src="https://github.com/user-attachments/assets/0ca4ac18-7176-47c9-813a-a6dde22c355f" />
<img width="713" height="403" alt="å…³é”®å¸§4" src="https://github.com/user-attachments/assets/540fb9f2-66dd-46a5-9cd1-b0dd9519d696" />

## ğŸš€ å¿«é€Ÿå¼€å§‹

> ğŸ’¡ **é¦–æ¬¡ä½¿ç”¨ï¼Ÿ** å…‹éš†é¡¹ç›®åç›´æ¥è¿è¡Œ `./start.sh`ï¼ˆMac/Linuxï¼‰æˆ– `start.bat`ï¼ˆWindowsï¼‰ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰è®¾ç½®ï¼

### ç³»ç»Ÿè¦æ±‚

- **Python**: 3.10+
- **Node.js**: 20+ï¼ˆä»…å‰ç«¯ï¼‰
- **Redis**: 5.0+ï¼ˆç”¨äºä»»åŠ¡é˜Ÿåˆ—ï¼‰
- **æ“ä½œç³»ç»Ÿ**: macOSï¼ˆæ¨èMç³»åˆ—èŠ¯ç‰‡ï¼‰ã€Linux æˆ– Windows
- **å†…å­˜**: è‡³å°‘4GBå¯ç”¨å†…å­˜

**Windowsç”¨æˆ·**ï¼š
- æ”¯æŒWindows 10/11
- éœ€è¦å®‰è£… [Redis for Windows](https://github.com/microsoftarchive/redis/releases)
- ä½¿ç”¨ `start.bat` ä¸€é”®å¯åŠ¨è„šæœ¬

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/MarcelLeon/key-face-frame.git
cd key-face-frame
```

#### 2. åç«¯è®¾ç½®

**å®‰è£…Pythonä¾èµ–**:
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½YOLOv8æ¨¡å‹ï¼ˆçº¦50MBï¼‰
```

**å®‰è£…å¹¶å¯åŠ¨Redis**:
```bash
# macOS (ä½¿ç”¨Homebrew)
brew install redis
redis-server --daemonize yes

# æˆ–ä½¿ç”¨ç³»ç»ŸæœåŠ¡
brew services start redis

# Linux (Ubuntu/Debian)
sudo apt-get install redis-server
sudo systemctl start redis

# éªŒè¯Redisè¿è¡Œ
redis-cli ping  # åº”è¿”å›: PONG
```

#### 3. å‰ç«¯è®¾ç½®

```bash
cd frontend
npm install
```

### å¯åŠ¨åº”ç”¨

#### æ–¹å¼1ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰â­

**æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼**ï¼Œè‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š

**Mac/Linux**:
```bash
./start.sh
```

**Windows**:
```bash
start.bat
```

**ä¸€é”®å¯åŠ¨è„šæœ¬åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨æ£€æŸ¥ä¾èµ–ï¼ˆPythonã€Node.jsã€Redisï¼‰
- âœ… è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ä¾èµ–åŒ…
- âœ… YOLOv8æ¨¡å‹ä¸‹è½½æç¤ºï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
- âœ… è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåç«¯ã€Celeryã€å‰ç«¯ã€Redisï¼‰
- âœ… Mac Mç³»åˆ—èŠ¯ç‰‡è‡ªåŠ¨ä½¿ç”¨ `--pool=solo` ä¼˜åŒ–
- âœ… å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- âœ… æ—¥å¿—è¾“å‡ºåˆ° `logs/` ç›®å½•

**åœæ­¢æœåŠ¡**ï¼š

**Mac/Linux**:
```bash
./stop.sh
```

**Windows**:
```bash
stop.bat
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
# åç«¯æ—¥å¿—
tail -f logs/backend.log

# Celeryæ—¥å¿—
tail -f logs/celery.log

# å‰ç«¯æ—¥å¿—
tail -f logs/frontend.log
```

---

#### æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

**éœ€è¦å¯åŠ¨4ä¸ªæœåŠ¡**ï¼ˆæ¨èä½¿ç”¨4ä¸ªç»ˆç«¯çª—å£ï¼‰:

<details>
<summary>ç‚¹å‡»å±•å¼€æ‰‹åŠ¨å¯åŠ¨æ­¥éª¤</summary>

##### ç»ˆç«¯1: FastAPIåç«¯
```bash
cd /path/to/key-face-frame
source .venv/bin/activate
uvicorn backend.main:app --reload --host 0.0.0.0 --port 8000
```

##### ç»ˆç«¯2: Celery Worker
```bash
cd /path/to/key-face-frame
source .venv/bin/activate

# macOS Mç³»åˆ—èŠ¯ç‰‡å¿…é¡»ä½¿ç”¨ --pool=solo å‚æ•°
celery -A backend.workers.tasks worker --loglevel=info --pool=solo

# å…¶ä»–ç³»ç»Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤æ¨¡å¼
# celery -A backend.workers.tasks worker --loglevel=info
```

**é‡è¦æç¤ºï¼ˆmacOS Mç³»åˆ—èŠ¯ç‰‡ç”¨æˆ·ï¼‰**:
- å¿…é¡»ä½¿ç”¨ `--pool=solo` å‚æ•°é¿å…MPSä¸preforkæ¨¡å¼çš„å†²çª
- è¯¦è§ [FAQ.md](FAQ.md#q3-celery-workerå´©æºƒ-worker-exited-prematurely-signal-6-sigabrt)

##### ç»ˆç«¯3: Redisï¼ˆå¦‚æœæœªä½¿ç”¨ç³»ç»ŸæœåŠ¡ï¼‰
```bash
redis-server
```

##### ç»ˆç«¯4: å‰ç«¯å¼€å‘æœåŠ¡å™¨
```bash
cd frontend
npm run dev
```

</details>

---

**è®¿é—®åº”ç”¨**: http://localhost:3000

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# æ„å»ºå‰ç«¯
cd frontend
npm run build

# å¯åŠ¨åç«¯ï¼ˆä¼šè‡ªåŠ¨æœåŠ¡é™æ€æ–‡ä»¶ï¼‰
cd ../
source .venv/bin/activate
uvicorn backend.main:app --host 0.0.0.0 --port 8000
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### Webç•Œé¢ä½¿ç”¨æµç¨‹

1. **é€‰æ‹©å¤„ç†æ¨¡å¼**
   - å¿«é€Ÿæ¨¡å¼ï¼šé‡‡æ ·ç‡10ï¼Œ10ä¸ªå…³é”®å¸§
   - æ ‡å‡†æ¨¡å¼ï¼šé‡‡æ ·ç‡5ï¼Œ20ä¸ªå…³é”®å¸§ï¼ˆæ¨èï¼‰
   - é«˜è´¨é‡æ¨¡å¼ï¼šé‡‡æ ·ç‡1ï¼Œ50ä¸ªå…³é”®å¸§

2. **ä¸Šä¼ è§†é¢‘**
   - æ‹–æ‹½è§†é¢‘åˆ°ä¸Šä¼ åŒºåŸŸï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
   - æ”¯æŒæ ¼å¼ï¼šMP4ã€MOVã€AVIã€MKV
   - æ–‡ä»¶å¤§å°é™åˆ¶ï¼š500MB

3. **å®æ—¶ç›‘æ§**
   - è‡ªåŠ¨è·³è½¬åˆ°å¤„ç†é¡µé¢
   - å®æ—¶æ˜¾ç¤ºè¿›åº¦ï¼ˆ0-100%ï¼‰
   - æ˜¾ç¤ºå½“å‰é˜¶æ®µï¼ˆæ£€æµ‹ä¸­/æå–ä¸­ï¼‰
   - æ˜¾ç¤ºå…ƒæ•°æ®ï¼ˆæ€»å¸§æ•°ã€æ£€æµ‹æ•°ã€å¤„ç†æ—¶é—´ï¼‰

4. **æŸ¥çœ‹ç»“æœ**
   - å¤„ç†å®Œæˆåè‡ªåŠ¨è·³è½¬åˆ°ç»“æœé¡µ
   - æŸ¥çœ‹æ‰€æœ‰å…³é”®å¸§ï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰
   - ç‚¹å‡»ä»»æ„å¸§æ”¾å¤§é¢„è§ˆ
   - æŒ‰è¯„åˆ†æˆ–æ—¶é—´æ’åº
   - ä¸‹è½½æ‰€æœ‰å…³é”®å¸§ï¼ˆZIPï¼‰

### å‘½ä»¤è¡Œä½¿ç”¨ï¼ˆPython APIï¼‰

ä»ç„¶æ”¯æŒv1.0çš„å‘½ä»¤è¡Œæ–¹å¼ï¼š

```python
import asyncio
from pathlib import Path
from backend.core.agents.detection_agent import DetectionAgent
from backend.core.agents.keyframe_agent import KeyframeAgent
from backend.core.agents.lead_agent import LeadAgent

async def main():
    detection_agent = DetectionAgent(model_name="yolov8m.pt")
    keyframe_agent = KeyframeAgent(output_dir=Path("output"))
    lead_agent = LeadAgent(detection_agent, keyframe_agent)

    result = await lead_agent.process_video(
        video_path=Path("your_video.mp4"),
        video_id="my-video",
        config={
            "sample_rate": 5,
            "max_frames": 20,
            "confidence_threshold": 0.5
        }
    )

    print(f"æå–äº† {result.keyframes_extracted} ä¸ªå…³é”®å¸§")
    print(f"è¾“å‡ºç›®å½•: {result.keyframe_dir}")

if __name__ == "__main__":
    asyncio.run(main())
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

**åç«¯**:
- FastAPI 0.109.0 - Webæ¡†æ¶
- SQLAlchemy 2.0.25 - ORM
- Celery 5.3.6 - å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
- Redis 5.0.1 - æ¶ˆæ¯é˜Ÿåˆ—
- YOLOv8 8.1.18 - äººç‰©æ£€æµ‹
- OpenCV 4.9.0 - å›¾åƒå¤„ç†
- PyTorch 2.2.0 - æ·±åº¦å­¦ä¹ æ¡†æ¶

**å‰ç«¯**:
- React 18 - UIæ¡†æ¶
- TypeScript 5 - ç±»å‹å®‰å…¨
- Vite 5 - æ„å»ºå·¥å…·
- Ant Design 5 - UIç»„ä»¶åº“
- Zustand 4 - çŠ¶æ€ç®¡ç†
- Axios 1 - HTTPå®¢æˆ·ç«¯
- React Router 6 - è·¯ç”±ç®¡ç†

### æ ¸å¿ƒæ¶æ„

```
Frontend (React + TS)
    â†“ HTTP
FastAPI (REST API)
    â†“
Celery Worker
    â†“
LeadAgent (åè°ƒå™¨)
    â”œâ”€> DetectionAgent (YOLOv8)
    â””â”€> KeyframeAgent (è¯„åˆ†+æå–)
    â†“
Output (JPEG + metadata.json)
```

## ğŸ“Š æ€§èƒ½å‚è€ƒ

åŸºäºMac M4æµ‹è¯•æ•°æ®ï¼š

| è§†é¢‘æ—¶é•¿ | åˆ†è¾¨ç‡ | é‡‡æ ·ç‡ | æ£€æµ‹æ•° | å…³é”®å¸§ | å¤„ç†æ—¶é—´ |
|---------|--------|--------|--------|--------|----------|
| 30ç§’    | 1080p  | 5      | 81     | 20     | ~3.5ç§’   |
| 60ç§’    | 1080p  | 5      | 150+   | 20     | ~7ç§’     |
| 120ç§’   | 1080p  | 10     | 200+   | 30     | ~10ç§’    |

## ğŸ“ è¾“å‡ºç»“æ„

```
output/
â””â”€â”€ video-{video_id}/
    â”œâ”€â”€ keyframes/
    â”‚   â”œâ”€â”€ frame_00045_t2.81s.jpg
    â”‚   â”œâ”€â”€ frame_00135_t8.44s.jpg
    â”‚   â””â”€â”€ ...
    â””â”€â”€ metadata.json
```

**metadata.jsonç¤ºä¾‹**:
```json
{
  "video_id": "my-video",
  "total_frames": 790,
  "total_detections": 123,
  "keyframes_extracted": 20,
  "processing_time_seconds": 7.08,
  "keyframes": [
    {
      "frame_index": 130,
      "timestamp": 5.2,
      "score": 0.880,
      "bbox": [460.99, 4.19, 1419.37, 1065.93],
      "filename": "frame_00130_t5.20s.jpg"
    }
  ]
}
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

é‡åˆ°é—®é¢˜ï¼Ÿè¯·æŸ¥çœ‹ **[FAQ.md](FAQ.md)** è·å–è¯¦ç»†çš„æ•…éšœæ’æŸ¥æŒ‡å—ï¼ŒåŒ…æ‹¬ï¼š

- Rediså’ŒCeleryå®‰è£…é…ç½®é—®é¢˜
- macOS MèŠ¯ç‰‡MPSå´©æºƒè§£å†³æ–¹æ¡ˆ
- å‰ç«¯è·¯ç”±å’ŒAnt Designè­¦å‘Š
- è§†é¢‘å¤„ç†é—®é¢˜æ’æŸ¥
- æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æŸ¥çœ‹æ—¥å¿—

**åç«¯æ—¥å¿—**:
```bash
# FastAPIæ—¥å¿—ï¼ˆåœ¨è¿è¡Œuvicornçš„ç»ˆç«¯ï¼‰
# Celery workeræ—¥å¿—ï¼ˆåœ¨è¿è¡Œceleryçš„ç»ˆç«¯ï¼‰

# æˆ–ä½¿ç”¨debugæ¨¡å¼æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
celery -A backend.workers.tasks worker --loglevel=debug
```

**å‰ç«¯æ—¥å¿—**:
- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
- æŸ¥çœ‹Consoleæ ‡ç­¾é¡µ
- æŸ¥çœ‹Networkæ ‡ç­¾é¡µçš„APIè¯·æ±‚

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./run_tests.sh

# å•å…ƒæµ‹è¯•
pytest tests/unit/ -v

# é›†æˆæµ‹è¯•
pytest tests/integration/ -v -m slow

# E2Eæµ‹è¯•
pytest tests/e2e/ -v
```

## ğŸ—ºï¸ è·¯çº¿å›¾

### v2.1 - åŠŸèƒ½å¢å¼º
- [ ] å†å²è®°å½•é¡µé¢
- [ ] æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
- [ ] è§†é¢‘é¢„è§ˆåŠŸèƒ½
- [ ] å…³é”®å¸§ç¼–è¾‘å’Œæ ‡æ³¨

### v3.0 - é«˜çº§åŠŸèƒ½
- [ ] äººè„¸è¯†åˆ«ï¼ˆåŒºåˆ†ä¸åŒäººç‰©ï¼‰
- [ ] åœºæ™¯æ£€æµ‹
- [ ] è§†é¢‘å‰ªè¾‘åŠŸèƒ½
- [ ] ç”¨æˆ·è®¤è¯å’Œå¤šç”¨æˆ·æ”¯æŒ

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æIssueå’ŒPRï¼è¯·ç¡®ä¿ï¼š

1. ä»£ç é€šè¿‡`black`å’Œ`isort`æ ¼å¼åŒ–
2. æ–°åŠŸèƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
3. å‰ç«¯éµå¾ªTypeScriptä¸¥æ ¼æ¨¡å¼
4. æ·»åŠ æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ“§ è”ç³»æ–¹å¼

- Issues: [GitHub Issues](https://github.com/MarcelLeon/key-face-frame/issues)
- Email: wangzq0708@gmail.com

## ğŸ’– èµåŠ©æ”¯æŒ / Sponsor

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿èµåŠ©æ”¯æŒå¼€å‘ï¼ğŸ¥°

<p align="center">
æ”¯ä»˜å®Alipay:<img src="docs/images/alipay.png" width="200" alt="æ”¯ä»˜å®" />
å¾®ä¿¡æ”¯ä»˜Wechat<img src="docs/images/wechat.png" width="200" alt="å¾®ä¿¡æ”¯ä»˜" />
</p>

---

**ç‰ˆæœ¬**: v2.0.0  
**æœ€åæ›´æ–°**: 2026-01-02  
**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ã€‚å¤„ç†è§†é¢‘æ—¶è¯·éµå®ˆç›¸å…³ç‰ˆæƒæ³•å¾‹ã€‚
